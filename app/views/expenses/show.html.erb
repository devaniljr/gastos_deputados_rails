<div class="container pt-4">
  <h1>Despesas de <%= @deputy.name %></h1>
  <p>A maior despesa foi de <%= number_to_currency(@deputy.biggest_expense.value, unit: "R$ ", separator: ",", delimiter: ".")  %></p>
  <p>Nome civil: <%= @deputy_api['nomeCivil'] %></p>
  <p>E-mail: <%= @deputy_api["ultimoStatus"]["gabinete"]["telefone"] %></p>
  <p>Telefone: <%= @deputy_api["ultimoStatus"]["gabinete"]["email"] %></p>

  <table class="table">
    <thead>
      <tr>
        <th scope="col">Data</th>
        <th scope="col">Fornecedor</th>
        <th scope="col">Valor</th>
        <th scope="col">Nota Fiscal</th>
      </tr>
    </thead>
    <tbody>
      <% @expenses.each do |exp| %>
        <% if exp == @deputy.biggest_expense %>
          <tr class="table-danger">
            <th scope="row"><%= l exp.date, format: :date_ %></th>
            <td><%= exp.provider_name %></td>
            <td><%= number_to_currency(exp.value, unit: "R$ ", separator: ",", delimiter: ".")  %></td>
            <td class="text-center"><%= link_to "üì•", exp.document_url %></td>
          </tr>
        <% else %>
          <tr>
            <th scope="row"><%= l exp.date, format: :date_ %></th>
            <td><%= exp.provider_name %></td>
            <td><%= number_to_currency(exp.value, unit: "R$ ", separator: ",", delimiter: ".")  %></td>
            <td class="text-center"><%= link_to "üì•", exp.document_url %></td>
          </tr>
        <% end %>
      <% end %>
    </tbody>
  </table>
  <%= paginate @expenses %>

  <h1>Gr√°ficos</h1>
  <h3 class="pb-4">Gastos com CEAP por m√™s de <%= @deputy.name %>:</h3>

  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">
    google.charts.load('current', {'packages':['bar']});
    google.charts.setOnLoadCallback(drawStuff);

    function drawStuff() {
      var data = new google.visualization.arrayToDataTable([
          ['Meses', 'Despesas (em mil)'],
          ["Janeiro/21", <%= @deputy.monthly_expenses('01', '2021') %>],
          ["Fevereiro", <%= @deputy.monthly_expenses('02', '2021') %>],
          ["Mar√ßo", <%= @deputy.monthly_expenses('03', '2021') %>],
          ["Abril", <%= @deputy.monthly_expenses('04', '2021') %>],
          ["Maio", <%= @deputy.monthly_expenses('05', '2021') %>],
          ["Junho", <%= @deputy.monthly_expenses('06', '2021') %>],
          ["Julho", <%= @deputy.monthly_expenses('07', '2021') %>],
          ["Agosto", <%= @deputy.monthly_expenses('08', '2021') %>],
          ["Setembro", <%= @deputy.monthly_expenses('09', '2021') %>],
          ["Outubro", <%= @deputy.monthly_expenses('10', '2021') %>],
          ["Novembro", <%= @deputy.monthly_expenses('11', '2021') %>],
          ["Dezembro", <%= @deputy.monthly_expenses('12', '2021') %>],
          ["Janeiro/22", <%= @deputy.monthly_expenses('01', '2022') %>]
      ]);

      var options = {
          width: 1000,
          legend: { position: 'none' },
          chart: {},
          axes: {
            x: {
              0: { side: 'bottom'} // Top x-axis.
            }
          },
          bar: { groupWidth: "90%" }
      };

      var chart = new google.charts.Bar(document.getElementById('top_x_div'));
        // Convert the Classic options to Material options.
        chart.draw(data, google.charts.Bar.convertOptions(options));
      };
  </script>

  <div id="top_x_div" style="width: 800px; height: 600px;"></div>

</div>
